## Тесты и бенчмарки (чтобы сдавать результаты выполнения без каких либо проблем)

В этом репозитории проверки разбиты по дням:
- `make test-day1` → `go test -tags=day1 ./...`
- `make test-day2` → `go test -tags=day2 ./...`

### 1) Как запускать тесты правильно
- Всё сразу:

```bash
go test ./...
```

- По дню:

```bash
make test-day1
make test-day2
```

- Без кеша (важно при отладке):

```bash
go test ./... -count=1
```

- Один пакет:

```bash
go test ./internal/skiplist -count=1
```

- Один тест:

```bash
go test ./internal/skiplist -run TestSkipList_ScanOrderAndRange -count=1
```

### 2) Как читать падение
Правило: **первая ошибка в логе** часто наиболее информативна.
Для первого дня типовые проблемы:
- неверная семантика `Scan([start,end))` (путают включительность границы `end`);
- неупорядоченный итератор;
- `nil` границы не трактуются как \(-∞\)/\(+∞\);
- забыли обновление существующего ключа на `Put`.

Сверяйтесь с чеклистом: `docs/review_checklist.md`.

### 3) Table-driven tests и subtests (как писать тесты быстро)
Шаблон:

```go
func TestX(t *testing.T) {
  tests := []struct{
    name string
    in   int
    want int
  }{
    {"case1", 1, 2},
  }
  for _, tt := range tests {
    t.Run(tt.name, func(t *testing.T) {
      // ...
    })
  }
}
```

### 4) Детерминизм: фиксированный seed
В заданиях первого дня в конструктор `SkipList` передают `seed` (см. `internal/skiplist/skiplist.go` и тесты).
Это нужно, чтобы:
- тесты были воспроизводимы;
- баги можно было повторить, а не “ловить” случайно.

### 5) Бенчмарки: минимум, который реально может помочь
Запуск:

```bash
go test ./internal/skiplist -bench . -benchmem
```

Шаблон:

```go
func BenchmarkPut(b *testing.B) {
  sl := New(1)
  b.ReportAllocs()
  b.ResetTimer()
  for i := 0; i < b.N; i++ {
    _ = sl.Put([]byte("k"), []byte("v"))
  }
}
```

Что смотреть:
- тренд при росте N (логарифм vs линейный);
- `allocs/op` (лишние аллокации в горячих местах).

### 6) Когда логировать
Вместо `fmt.Println` в тестах используйте:
- `t.Logf(...)` (видно при падении или `-v`).

### 7) Мини-алгоритм отладки “красных” (отрицительных) тестов
- сузить область (пакет -> тест);
- добавить `t.Logf` вокруг подозрительных мест;
- проверить границы `Scan`, обновление ключей, обработку `ErrNotFound`.
